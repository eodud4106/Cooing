<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- p_message 처리 SQL -->
<mapper namespace="com.cooing.www.hindoong.dao.P_messageMapper">

	<!-- p_message 정보 저장 -->
	<insert id="insertMessage" parameterType="message">
	INSERT INTO p_message (
		p_message_num,
		p_message_from,
		p_message_to,
		p_message_message,
		p_message_date
	)
	VALUES (
		p_message_seq.nextval,
		#{message_from},
		#{message_to},
		#{message_message},
		sysdate
	)
	</insert>
	
	<update id="updateMessage">
	UPDATE p_message
	SET
		p_message_read = 0
	WHERE
		p_message_read = 1 and p_message_from = #{id} and p_message_to = #{counterpart}
	</update>
	
	<select id="selectMessage" resultType="message">
	SELECT
		p_message_num AS message_num,
		p_message_from AS message_from,
		p_message_to AS message_to,
		p_message_message AS message_message,
		p_message_read AS message_read,
		p_message_date AS message_date
	FROM p_message
	WHERE
		(p_message_from = #{id1} and p_message_to = #{id2})
		OR
		(p_message_from = #{id2} and p_message_to = #{id1})
	ORDER BY
		p_message_date
	</select>
	
	<select id="selectUnreadMessage" resultType="int">
	SELECT
		count(*)
	FROM p_message
	WHERE
		(p_message_from = #{from} and p_message_to = #{to})
		AND
		p_message_read = 1
	</select>

</mapper>
